psj.content.metadataregistry
****************************

A tool for creating metadata schemas.

:Test-Layer: integration


psj.content provides a `metadataschemas_registry` which manages
metadata schemata for content objects::

  >>> from pprint import pprint
  >>> reg = self.portal['metadataschemas_registry']
  >>> reg
  <MetadataSchemaRegistry at /plone/metadataschemas_registry>

This registry stores available schemata and knows, which content types
are linked to a specific schema. It comes with some ready-for-use
schemata out of the box::

  >>> reg.listSchemas()
  [...]

Metadata schemata are connected to special content types in the
metadata registry. The registry therefore manages a list of supported
object types::

  >>> sorted(reg.listContentTypes())
  ['psjbook', 'psjdocument', 'psjissue', 'psjmagazine', 'psjvolume']

We can get dict of content types directly::

  >>> from pprint import pprint
  >>> pprint(reg.contentTypes())
  {'psjvolume': {...}, 'psjdocument': {...}, 'psjissue': {...}, ...}

XXX: Apparently, pprint does not work here. Why?

A special content type can also be looked up by id::

  >>> reg.lookupContentType('psjdocument')
  {'dotted_path': ..., 'title': ..., 'schema': None}


Adding schemata
===============

We can add a new schema::

  >>> reg.manage_addMetadataSchema(
  ...   'myschema', objecttype='psjdocument',
  ...   fields=(dict(title='title',
  ...                type='TextLine',
  ...                default=None),
  ...           dict(title='is great',
  ...                type='Boolean',
  ...                default=True),
  ...           dict(title='A link',
  ...                type='Relation'),
  ...          )
  ...   )

  >>> reg.listSchemas()
  ['myschema']

The new schema can be retrieved directly::

  >>> reg.schemas()['myschema']
  <psj.content.metadata.metadata.MetadataSet object at 0x...>

The link to the objecttype is not stored with the schema, but in the
list of object types::

  >>> reg.lookupContentType('psjdocument')['schema']
  'myschema'


Retrieving MetadataSets
=======================

We can also ask, which content types are connected to a special schema::

  >>> reg.getContentTypesForSchema('myschema')
  ['psjdocument']

For the handling of object attributes (see extenders.txt), it is
crucial to have a possibility, to retrieve a metadata sets for a
certain object type. Typically, the object handler will pass a certain
object and ask for a metadata schema that 'fits'::

  >>> from psj.content.content.psjdocument import PSJDocument
  >>> d = PSJDocument('Wierd Title')

  >>> data = reg.getSchemaForObject(d)
  >>> data
  <psj.content.metadata.metadata.MetadataSet object at 0x...>

  >>> sorted(list(data))
  ['a_link', 'is_great', 'title']

